<?xml version="1.0" encoding="UTF-8"?>
<!-- 编辑使用 XMLSpy v2006 U (http://www.altova.com) 由 any (any) -->
<!-- 编辑使用 XMLSpy v2006 U (http://www.altova.com) 由 any (any) -->
<!-- 编辑使用 XMLSpy v2006 U (http://www.altova.com) 由 any (any) -->
<Tasks xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="C:\mydoc\myprojects\ereminder\Reminder\modules\shopping\src\main\resources\Task_2_0.xsd" rootVolume="999990" storeId="nasdaq-earn-announce" productType="default">
	<PrdTask tryPattern="false">
		<baseBrowseTask enableJS="false" dsm="nothing" taskName="nasdaq-earn-announce" mbMemoryNeeded="512">
			<param name="marketId" type="string"/>
			<param name="startDate" type="string"/>
			<param name="endDate" type="string"/>
			<param name="date" type="string"/>
			<param name="HasHeader" type="boolean" value="false"/>
			<startUrl value="http://www.nasdaq.com/earnings/earnings-calendar.aspx?date=[date]"/>
			<userAttribute name="id">
				<value value="'nasdaq-earn-announce_' + date" fromType="expression"/>
			</userAttribute>
			<userAttribute name="ColNum">
				<value value="8" toType="list" toEntryType="int"/>
			</userAttribute>
			<userAttribute name="DataType1">
				<value value="Text,Text,Date,Text,Number,Number,Text,Number" toType="list" toEntryType="string"/>
			</userAttribute>
			<userAttribute name="data1">
				<value value="//div[@id='two_column_main_content_pnlInsider']/table/tbody/tr/td[position()&lt;9]|//div[@id='two_column_main_content_Pnunconfirm']/table/tbody/tr/td[position()&lt;9]" toType="list" toEntryType="string" optional="true"/>
			</userAttribute>
			<pageVerify operator="!=">
				<lhs value="//span[@id='two_column_main_content_lreportlink1']"/>
				<rhs value="null"/>
			</pageVerify>
			<csvtransform outputType="byJobSingle" transformClass="org.cld.etl.csv.MultiRowTablesAsCSV">
				<ops>
					<expression>
						<!-- match the last pair of paranthese -->
						function getId(str) {
							var rgx = /\(([^)]+)\)(?!\(([^)]+)\))/;
							var match = str.match(rgx);
							if (match)
								return match[1];
							else
								return str;
						}
						function merge(arr){
						    return rarr.join(',')
						}
						rarr = arr.split(',')
						rarr[1] = getId(rarr[1])
						merge(rarr)
					</expression>
				</ops>
			</csvtransform>
		</baseBrowseTask>
	</PrdTask>
</Tasks>
